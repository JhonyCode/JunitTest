<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ValidateJsonQvantel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JunitTest</a> &gt; <a href="index.source.html" class="el_package">co.com.utility</a> &gt; <span class="el_source">ValidateJsonQvantel.java</span></div><h1>ValidateJsonQvantel.java</h1><pre class="source lang-java linenums">package co.com.utility;

import java.lang.reflect.Method;
import java.util.List;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

<span class="nc" id="L10">public class ValidateJsonQvantel {</span>

	private static final String TYPE_MOBILE = &quot;mobile&quot;;
	private static final String TYPE_FIJO = &quot;fija&quot;;

	public static void main(String[] args) {

		try {
<span class="nc" id="L18">			String valor = jsonGet(dataJson, &quot;contact-media&quot;).toString();</span>
<span class="nc" id="L19">			String limpio = cleanMedia(valor).toString();</span>
<span class="nc" id="L20">			String limpio2 = cleanMedia(dataJson, &quot;contact-media&quot;).toString();</span>
			// String email = arrayGet(valor, &quot;medium.email&quot;).toString();
<span class="nc" id="L22">			System.out.println(&quot;El valor es :&quot; + valor);</span>
			// System.out.println(&quot;El email es: &quot; + email);
<span class="nc" id="L24">			System.out.println(&quot;limpio &quot; + limpio);</span>
<span class="nc" id="L25">			System.out.println(&quot;limpio2 &quot; + limpio2);</span>

<span class="nc" id="L27">		} catch (Exception e) {</span>
<span class="nc" id="L28">			e.printStackTrace();</span>
<span class="nc" id="L29">		}</span>
<span class="nc" id="L30">	}</span>

<span class="nc" id="L32">	public static String dataJson = &quot;{\r\n&quot; + &quot;   \&quot;code\&quot;:\&quot;14\&quot;,\r\n&quot;</span>
			+ &quot;   \&quot;description\&quot;:\&quot;End-query type 5. The last name entered if it matches the one registered in the database for that ID number, but the person does NOT have commercial information in the DataCrï¿½dito database. \&quot;,\r\n&quot;
			+ &quot;   \&quot;identifications\&quot;:{\r\n&quot; + &quot;      \&quot;identification-type\&quot;:\&quot;CC\&quot;,\r\n&quot;
			+ &quot;      \&quot;identification-id\&quot;:50000000,\r\n&quot; + &quot;      \&quot;issuing-date\&quot;:\&quot;2020-01-10\&quot;,\r\n&quot;
			+ &quot;      \&quot;issuing-authority\&quot;:{\r\n&quot; + &quot;         \&quot;country\&quot;:\&quot;CO\&quot;,\r\n&quot;
			+ &quot;         \&quot;state-or-province\&quot;:\&quot;ANtioquia\&quot;,\r\n&quot; + &quot;         \&quot;city\&quot;:\&quot;MEDELLIN\&quot;\r\n&quot; + &quot;      }\r\n&quot;
			+ &quot;   },\r\n&quot; + &quot;   \&quot;individuals\&quot;:{\r\n&quot; + &quot;      \&quot;given-name\&quot;:\&quot;Alfried\&quot;,\r\n&quot;
			+ &quot;      \&quot;additional-name\&quot;:\&quot;R\&quot;,\r\n&quot; + &quot;      \&quot;family-name\&quot;:\&quot;Gruber P\&quot;,\r\n&quot;
			+ &quot;      \&quot;gender\&quot;:\&quot;male\&quot;\r\n&quot; + &quot;   },\r\n&quot; + &quot;   \&quot;contact-media\&quot;:[\r\n&quot; + &quot;      {\r\n&quot;
			+ &quot;         \&quot;medium\&quot;:{\r\n&quot; + &quot;            \&quot;email\&quot;:\&quot;ag@gmail.com\&quot;\r\n&quot; + &quot;         },\r\n&quot;
			+ &quot;         \&quot;medium-type\&quot;:\&quot;email-address\&quot;,\r\n&quot; + &quot;         \&quot;role\&quot;:\&quot;primary\&quot;\r\n&quot; + &quot;      },\r\n&quot;
			+ &quot;      {\r\n&quot; + &quot;         \&quot;medium\&quot;:{\r\n&quot; + &quot;            \&quot;telephone-number\&quot;:3170000000,\r\n&quot;
			+ &quot;            \&quot;number-type\&quot;:\&quot;mobile\&quot;\r\n&quot; + &quot;         },\r\n&quot;
			+ &quot;         \&quot;medium-type\&quot;:\&quot;telephone-number\&quot;,\r\n&quot; + &quot;         \&quot;role\&quot;:\&quot;primary\&quot;\r\n&quot;
			+ &quot;      },\r\n&quot; + &quot;      {\r\n&quot; + &quot;         \&quot;medium\&quot;:{\r\n&quot;
			+ &quot;            \&quot;telephone-number\&quot;:3180000000,\r\n&quot; + &quot;            \&quot;number-type\&quot;:\&quot;mobile\&quot;\r\n&quot;
			+ &quot;         },\r\n&quot; + &quot;         \&quot;medium-type\&quot;:\&quot;telephone-number\&quot;,\r\n&quot;
			+ &quot;         \&quot;role\&quot;:\&quot;marketing\&quot;\r\n&quot; + &quot;      },\r\n&quot; + &quot;      {\r\n&quot; + &quot;         \&quot;medium\&quot;:{\r\n&quot;
			+ &quot;            \&quot;telephone-number\&quot;:3190000000,\r\n&quot; + &quot;            \&quot;number-type\&quot;:\&quot;mobile\&quot;\r\n&quot;
			+ &quot;         },\r\n&quot; + &quot;         \&quot;medium-type\&quot;:\&quot;telephone-number\&quot;,\r\n&quot;
			+ &quot;         \&quot;role\&quot;:\&quot;marketing\&quot;\r\n&quot; + &quot;      },\r\n&quot; + &quot;      {\r\n&quot; + &quot;         \&quot;medium\&quot;:{\r\n&quot;
			+ &quot;            \&quot;telephone-number\&quot;:5710000,\r\n&quot; + &quot;            \&quot;number-type\&quot;:\&quot;fixed-line\&quot;\r\n&quot;
			+ &quot;         },\r\n&quot; + &quot;         \&quot;medium-type\&quot;:\&quot;telephone-number\&quot;,\r\n&quot;
			+ &quot;         \&quot;role\&quot;:\&quot;primary\&quot;\r\n&quot; + &quot;      },\r\n&quot; + &quot;      {\r\n&quot; + &quot;         \&quot;medium\&quot;:{\r\n&quot;
			+ &quot;            \&quot;street\&quot;:\&quot;Calle 1B sur\&quot;,\r\n&quot; + &quot;            \&quot;postal-code\&quot;:\&quot;fixed-line\&quot;,\r\n&quot;
			+ &quot;            \&quot;state-or-province\&quot;:\&quot;05\&quot;,\r\n&quot; + &quot;            \&quot;city\&quot;:\&quot;5001\&quot;,\r\n&quot;
			+ &quot;            \&quot;county\&quot;:\&quot;9001001\&quot;\r\n&quot; + &quot;         },\r\n&quot;
			+ &quot;         \&quot;medium-type\&quot;:\&quot;postal-address\&quot;,\r\n&quot; + &quot;         \&quot;role\&quot;:\&quot;primary\&quot;\r\n&quot; + &quot;      },\r\n&quot;
			+ &quot;      {\r\n&quot; + &quot;         \&quot;medium\&quot;:{\r\n&quot; + &quot;            \&quot;street\&quot;:\&quot;Calle el Poblado\&quot;,\r\n&quot;
			+ &quot;            \&quot;postal-code\&quot;:\&quot;fixed-line\&quot;,\r\n&quot; + &quot;            \&quot;state-or-province\&quot;:\&quot;05\&quot;,\r\n&quot;
			+ &quot;            \&quot;city\&quot;:\&quot;5001\&quot;,\r\n&quot; + &quot;            \&quot;county\&quot;:\&quot;9001001\&quot;\r\n&quot; + &quot;         },\r\n&quot;
			+ &quot;         \&quot;medium-type\&quot;:\&quot;postal-address\&quot;,\r\n&quot; + &quot;         \&quot;role\&quot;:\&quot;marketing\&quot;\r\n&quot; + &quot;      }\r\n&quot;
			+ &quot;   ]\r\n&quot; + &quot;}&quot;;

	public static Object cleanMedia(String text, String key) throws Exception {

<span class="nc" id="L68">		Object value = &quot;&quot;;</span>

		try {

<span class="nc" id="L72">			JSONObject json = new JSONObject(text);</span>
<span class="nc" id="L73">			JSONArray jsonArray = new JSONArray(cleanMedia(jsonGet(text, key).toString()).toString());</span>

<span class="nc" id="L75">			json.put(key, jsonArray);</span>

<span class="nc" id="L77">			value = json.toString();</span>

<span class="nc" id="L79">		} catch (Exception e) {</span>
<span class="nc" id="L80">			System.out.println(&quot;Error &quot; + e.getMessage());</span>
<span class="nc" id="L81">		}</span>
<span class="nc" id="L82">		return value;</span>
	}

	private static Object cleanMedia(String text) throws Exception {

<span class="nc" id="L87">		Object value = &quot;&quot;;</span>
<span class="nc" id="L88">		boolean hayFijo = false;</span>
<span class="nc" id="L89">		boolean hayMobile = false;</span>
<span class="nc" id="L90">		int indexF = 0;</span>
<span class="nc" id="L91">		int indexM = 0;</span>

		try {
<span class="nc" id="L94">			JSONArray newArray = new JSONArray();</span>
<span class="nc" id="L95">			JSONArray array = new JSONArray(text);</span>

<span class="nc bnc" id="L97" title="All 2 branches missed.">			for (int i = array.length() - 1; i &gt;= 0; i--) {</span>
<span class="nc" id="L98">				Object role = jsonGet(array.get(i).toString(), &quot;role&quot;);</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">				if (role.equals(&quot;primary&quot;)) {</span>
<span class="nc" id="L100">					Object type = jsonGet(array.get(i).toString(), &quot;medium.number-type&quot;);</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">					if (type == null) {</span>
<span class="nc" id="L102">						newArray.put(array.get(i));</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">					} else if (type.toString().equalsIgnoreCase(TYPE_MOBILE)) {</span>
<span class="nc" id="L104">						hayMobile = true;</span>
<span class="nc" id="L105">						indexM = i;</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">					} else if (type.toString().equalsIgnoreCase(TYPE_FIJO)) {</span>
<span class="nc" id="L107">						hayFijo = true;</span>
<span class="nc" id="L108">						indexF = i;</span>
					}
				}
			}

<span class="nc bnc" id="L113" title="All 8 branches missed.">			if (hayFijo &amp;&amp; hayMobile || hayMobile &amp;&amp; !hayFijo) {</span>
<span class="nc" id="L114">				newArray.put(array.get(indexM));</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">			} else if (hayFijo) {</span>
<span class="nc" id="L116">				newArray.put(array.get(indexF));</span>
			}

<span class="nc" id="L119">			value = newArray.toString();</span>

<span class="nc" id="L121">		} catch (Exception e) {</span>
<span class="nc" id="L122">			System.out.println(&quot;Error &quot; + e.getMessage());</span>
<span class="nc" id="L123">		}</span>
<span class="nc" id="L124">		return value;</span>
	}

	public static Object jsonArray(String text, String key) throws Exception {
<span class="nc" id="L128">		return jsonValue(text, key, true, null);</span>
	}

	public static Object jsonGet(String text, String key) throws Exception {
<span class="nc" id="L132">		return jsonValue(text, key, false, null);</span>
	}

	public static Object jsonGetCondition(String text, String key, List&lt;JsonCondition&gt; conditions) throws Exception {
<span class="nc" id="L136">		return jsonValue(text, key, false, conditions);</span>
	}

	public static Object jsonGetConditions(String text, String key, List&lt;JsonCondition&gt; conditions) throws Exception {
<span class="nc" id="L140">		return jsonValue(text, key, true, conditions);</span>
	}

	private static Object jsonValue(String text, String key, boolean isArray, List&lt;JsonCondition&gt; conditions)
			throws Exception {
		try {
<span class="nc bnc" id="L146" title="All 2 branches missed.">			if (key.contains(&quot;.&quot;)) {</span>

<span class="nc" id="L148">				text = valueGet(text, key.substring(0, key.indexOf(&quot;.&quot;))).toString();</span>
<span class="nc" id="L149">				key = key.substring(key.indexOf(&quot;.&quot;) + 1);</span>

<span class="nc bnc" id="L151" title="All 2 branches missed.">				if (text.charAt(0) == '[') {</span>
<span class="nc" id="L152">					return arrayGet(text, key, isArray, conditions);</span>
				} else {
<span class="nc" id="L154">					return jsonValue(text, key, false, null);</span>
				}
			}
<span class="nc" id="L157">			return valueGet(text, key);</span>
<span class="nc" id="L158">		} catch (Exception e) {</span>
<span class="nc" id="L159">			return null;</span>
		}
	}

	private static Object getKeyCondition(String json, String key) throws Exception {
<span class="nc" id="L164">		Object item = null;</span>
		try {
<span class="nc" id="L166">			item = jsonGet(json, key);</span>

<span class="nc bnc" id="L168" title="All 2 branches missed.">			if (item == null) {</span>
<span class="nc" id="L169">				return getKeyCondition(json, key.substring(key.indexOf(&quot;.&quot;) + 1));</span>
			}

<span class="nc" id="L172">		} catch (Exception e) {</span>
<span class="nc" id="L173">			throw e;</span>
<span class="nc" id="L174">		}</span>
<span class="nc" id="L175">		return item;</span>
	}

	private static boolean validaCondition(String json, List&lt;JsonCondition&gt; conditions) throws Exception {
<span class="nc bnc" id="L179" title="All 2 branches missed.">		for (JsonCondition condition : conditions) {</span>
<span class="nc" id="L180">			Object itemCondition = getKeyCondition(json, condition.getKey());</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">			if (itemCondition != null) {</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">				if (condition.getValues() != null) {</span>
<span class="nc" id="L183">					boolean isOption = true;</span>
<span class="nc bnc" id="L184" title="All 2 branches missed.">					for (String value : condition.getValues()) {</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">						if (!itemCondition.toString().equalsIgnoreCase(value)) {</span>
<span class="nc" id="L186">							isOption = false;</span>
						}
					}

<span class="nc bnc" id="L190" title="All 2 branches missed.">					if (isOption) {</span>
<span class="nc" id="L191">						return false;</span>
					}

<span class="nc bnc" id="L194" title="All 2 branches missed.">				} else if (condition.getValue() != null</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">						&amp;&amp; !itemCondition.toString().equalsIgnoreCase(condition.getValue())) {</span>
<span class="nc" id="L196">					return false;</span>
				}

			}
<span class="nc" id="L200">		}</span>
<span class="nc" id="L201">		return true;</span>
	}

	private static Object arrayGet(String text, String key, boolean isArray, List&lt;JsonCondition&gt; conditions)
			throws Exception {

<span class="nc" id="L207">		Object value = null;</span>

		try {
<span class="nc" id="L210">			JSONArray array = new JSONArray(text);</span>
<span class="nc" id="L211">			JSONArray newArray = new JSONArray();</span>

<span class="nc bnc" id="L213" title="All 2 branches missed.">			for (int i = 0; i &lt; array.length(); i++) {</span>
<span class="nc" id="L214">				Object item = jsonGet(array.get(i).toString(), key);</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">				if (item != null) {</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">					if (conditions != null) {</span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">						if (validaCondition(array.get(i).toString(), conditions)) {</span>
<span class="nc" id="L218">							newArray.put(item);</span>
<span class="nc" id="L219">							value = item;</span>
<span class="nc bnc" id="L220" title="All 2 branches missed.">							if (!isArray) {</span>
<span class="nc" id="L221">								break;</span>
							}
						}
					} else {
<span class="nc" id="L225">						newArray.put(item);</span>
<span class="nc" id="L226">						value = item;</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">						if (!isArray) {</span>
<span class="nc" id="L228">							break;</span>
						}
					}
				}
			}
<span class="nc bnc" id="L233" title="All 2 branches missed.">			if (isArray) {</span>
<span class="nc" id="L234">				value = newArray.toString();</span>
			}

<span class="nc" id="L237">		} catch (Exception e) {</span>
<span class="nc" id="L238">			throw e;</span>
<span class="nc" id="L239">		}</span>
<span class="nc" id="L240">		return value;</span>
	}

	private static Object valueGet(String text, String key) throws Exception {

<span class="nc" id="L245">		Object value = null;</span>
		try {
<span class="nc" id="L247">			JSONObject json = new JSONObject(text);</span>

<span class="nc bnc" id="L249" title="All 2 branches missed.">			if (json.has(key)) {</span>
<span class="nc" id="L250">				value = json.get(key);</span>
			}

<span class="nc" id="L253">		} catch (JSONException e) {</span>
<span class="nc" id="L254">			throw e;</span>
<span class="nc" id="L255">		}</span>
<span class="nc" id="L256">		return value;</span>
	}

	private static String dataFunction(String funcion) {
<span class="nc" id="L260">		return &quot;setData&quot; + funcion;</span>
	}

	private static String foundFunction(String funcion) {
<span class="nc" id="L264">		return &quot;setFound&quot; + funcion;</span>
	}

	public static void executeMethod(Object value, String funcion, IncompleteDataDTO incompleteDataDTO)
			throws Exception {

		try {
<span class="nc" id="L271">			Method[] metodos = incompleteDataDTO.getClass().getMethods();</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">			for (Method metodo : metodos) {</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">				if (metodo.getName().equalsIgnoreCase(dataFunction(funcion))) {</span>
<span class="nc" id="L274">					Method method = incompleteDataDTO.getClass().getMethod(dataFunction(funcion), String.class);</span>
<span class="nc bnc" id="L275" title="All 2 branches missed.">					method.invoke(incompleteDataDTO, value != null ? value.toString() : &quot;&quot;);</span>
<span class="nc bnc" id="L276" title="All 2 branches missed.">				} else if (metodo.getName().equalsIgnoreCase(foundFunction(funcion))) {</span>
<span class="nc" id="L277">					Method method = incompleteDataDTO.getClass().getMethod(foundFunction(funcion), Boolean.TYPE);</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">					method.invoke(incompleteDataDTO, (value != null));</span>
				}
			}
<span class="nc" id="L281">		} catch (Exception ex) {</span>
<span class="nc" id="L282">			throw new Exception(&quot;Error ejecuntado metodo &quot; + funcion, ex);</span>
<span class="nc" id="L283">		}</span>
<span class="nc" id="L284">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>